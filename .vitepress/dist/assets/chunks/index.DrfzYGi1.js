import{_ as B,c as m,e as y,o as h,j as r,a1 as f,n as b,aj as g,b as D,J as F,ak as v,w as M,G as k,H as x,P as L,al as E,t as I,am as X,T as H,ah as Y,an as A,ao as P}from"./framework.zNPsoP7e.js";const G={name:"hevue-img-preview",data(){return{vue:A,showHevueImgRotate:!1,visible:!1,imgScale:1,imgTop:0,imgLeft:0,imgRotate:0,isFull:!1,maxWH:{"max-width":"100%","max-height":"100%"},clientX:0,clientY:0,imgIndex:0,canRun:!0,imgurl:"",imgState:1,start:[{},{}],fromIndex:0,mobileScale:0,imgList:[],nowImgIndex:0,thumbnail:!0,controlBar:[],closeBtn:!0,arrowBtn:!0,keyboard:!0,clickMaskCLose:!0,closeFn:null,changeFn:null,customStyle:[],themeName:"glass",disabledImgRightClick:!1,showTranstion:!1,needLoadImg:[],showHevueImgHelp:!1,shortcutList:[{keyNum:27,keyName:"Esc",desc:"退出预览",handle:()=>{this.close({way:"esc"})}},{keyNum:65,keyName:"A",desc:"上一张",handle:()=>{this.multiple&&this.prevNextHandle(!1,"key-a")}},{keyNum:68,keyName:"D",desc:"下一张",handle:()=>{this.multiple&&this.prevNextHandle(!0,"key-d")}},{keyNum:87,keyName:"W",desc:"放大",handle:()=>{this.scaleFunc(.15)}},{keyNum:83,keyName:"S",desc:"缩小",handle:()=>{this.scaleFunc(-.15)}},{keyNum:37,keyName:"←",desc:"上一张",handle:()=>{this.multiple&&this.prevNextHandle(!1,"key-left")}},{keyNum:39,keyName:"→",desc:"下一张",handle:()=>{this.multiple&&this.prevNextHandle(!0,"key-right")}},{keyNum:38,keyName:"↑",desc:"放大",handle:()=>{this.scaleFunc(.15)}},{keyNum:40,keyName:"↓",desc:"缩小",handle:()=>{this.scaleFunc(-.15)}},{keyNum:81,keyName:"Q",desc:"逆时针旋转",handle:()=>{this.rotateFunc(-90)}},{keyNum:69,keyName:"E",desc:"顺时针旋转",handle:()=>{this.rotateFunc(90)}},{keyNum:82,keyName:"R",desc:"复位",handle:()=>{this.initImg()}}],controlbarAllItems:[{key:"zoomOut",icon:"&#xe65e;",title:"缩小",show:()=>!0,handle:()=>{this.scaleFunc(-.15)}},{key:"zoomIn",icon:"&#xe65d;",title:"放大",show:()=>!0,handle:()=>{this.scaleFunc(.15)}},{key:"rotateLeft",icon:"&#xe662;",title:"向左旋转",show:()=>!0,handle:()=>{this.rotateFunc(-90)}},{key:"customRotate",icon:"&#xe927;",title:"自定义旋转",show:()=>!0,handle:()=>{this.showHevueImgRotate=!this.showHevueImgRotate}},{key:"rotateRight",icon:"&#xe663;",title:"向右旋转",show:()=>!0,handle:()=>{this.rotateFunc(90)}},{key:"reset",icon:"&#xe86b;",title:"复位",show:()=>!0,handle:()=>{this.initImg()}},{key:"prev",icon:"&#xe62f;",title:"上一个",show:()=>()=>this.multiple,handle:()=>{this.prevNextHandle(!1,"control-bar")}},{key:"next",icon:"&#xe62e;",title:"下一个",show:()=>()=>this.multiple,handle:()=>{this.prevNextHandle(!0,"control-bar")}},{key:"download",icon:"&#xe694;",title:"下载",show:()=>!0,handle:()=>{this.downloadIamge()}},{key:"help",icon:"&#xe626;",title:"帮助",show:()=>this.keyboard,handle:()=>{this.showHevueImgHelp=!this.showHevueImgHelp}}]}},created(){},mounted(){this.initImg()},computed:{vueVersion(){return parseInt(this.vue.version)},controlbarShowItems(){return this.controlBar.map(e=>this.controlbarAllItems.find(s=>s.key===e))},multiple(){return Array.isArray(this.imgList)&&this.imgList.length>1},getImgPostion(){return{...this.maxWH,transform:`scale(${this.imgScale}) rotate(${this.imgRotate}deg)`,marginTop:this.imgTop+"px",marginLeft:this.imgLeft+"px"}}},watch:{customStyle:{handler(e){let t=Object.entries(e);this.$nextTick(()=>{t.length>0&&t.forEach(s=>{let o=s[0],i=s[1],n=document.querySelector(".hevue-imgpreview-wrap");n&&n.style.setProperty(o,i)})})},immediate:!0,deep:!0},url(){this.initImg()},visible:{handler(e){e&&this.$nextTick(()=>{let t=document.getElementById("hevue-imgpreview-wrap");t.onmousewheel=this.scrollFunc,document.body.addEventListener("DOMMouseScroll",this.scrollFunc),document.ondragstart=function(){return!1},this.themeName&&t.classList.add(this.themeName),this.disableTransition&&t.classList.add("disableTransition"),Array.isArray(this.controlBar)?this.controlBar.length===0&&(this.controlBar=this.controlbarAllItems.map(s=>s.key)):this.controlBar=[],this.url&&(!this.imgList||this.imgList.length===0)&&(this.imgList=[this.url]),this.imgIndex=Number(this.nowImgIndex)||0,this.changeUrl(this.imgList[this.imgIndex],this.imgIndex),this.keyboard&&document.addEventListener("keydown",this.keyHandleDebounce)})},immediate:!0}},methods:{show(){this.visible=!0,setTimeout(()=>{this.showTranstion=!0},20)},close(e){this.showTranstion=!1,setTimeout(()=>{this.initImg(),document.body.removeEventListener("DOMMouseScroll",this.scrollFunc),document.ondragstart=null,this.keyboard&&document.removeEventListener("keydown",this.keyHandleDebounce),this.visible=!1,this.closeFn&&this.closeFn(e),this.showHevueImgHelp=!1,this.imgList=[]},500)},initImg(){this.mobileScale=1,this.imgScale=1,this.imgRotate=0,this.imgTop=0,this.imgLeft=0},imgContextMenu(e){e=e||window.event,this.disabledImgRightClick&&e.preventDefault()},prevNextHandle(e,t){let s=0;e?(s=this.imgIndex+1,s>this.imgList.length-1&&(s=0)):(s=this.imgIndex-1,s<0&&(s=this.imgList.length-1)),this.toogleImg(s,t,e)},toogleImg(e,t,s){if(this.imgIndex===e)return;this.fromIndex=this.imgIndex;let o=this.imgIndex;this.imgIndex=e;let i=t=="thumb"?"thumb":s?"next":"prev";this.changeFn&&this.changeFn({type:i,fromImgIndex:o,fromImgUrl:this.imgList[o],toImgIndex:this.imgIndex,toImgUrl:this.imgList[this.imgIndex],way:t}),this.changeUrl(this.imgList[this.imgIndex],this.imgIndex)},changeUrl(e,t){this.needLoadImg.find(o=>o.index==t)?this.imgState=2:(this.imgState=1,this.needLoadImg.push({url:e,index:t}),this.$nextTick(()=>{let o=this.$refs["heImg"+t][0];o.onload=()=>{t!=null&&t==this.imgIndex?this.imgState=2:t==null&&(this.imgState=2)},o.onerror=()=>{t!=null&&t==this.imgIndex?this.imgState=3:t==null&&(this.imgState=3)}}))},getThumbLeft(){return-(this.imgIndex*100+50)},rotateFunc(e){let t=+this.imgRotate+e;t>360?t=t-360:t<0&&(t=360+t),this.imgRotate=t},scaleFunc(e,t){this.imgScale<=.2&&e<0||(t?this.imgScale=e:this.imgScale+=e)},imgToggle(){this.initImg(),this.isFull?this.maxWH={"max-width":"100%","max-height":"100%"}:this.maxWH="",this.isFull=!this.isFull},scrollFunc(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&this.scaleFunc(.05),e.delta<0&&this.scaleFunc(-.05)},addMove(e){e=e||window.event,this.clientX=e.clientX,this.clientY=e.clientY,this.$refs.heImg.onmousemove=this.moveFunc},addMoveMobile(e){e.preventDefault(),e=e||window.event,e.touches.length>1?this.start=e.touches:(this.clientX=e.touches[0].pageX,this.clientY=e.touches[0].pageY),this.$refs.heImg.ontouchmove=this.moveFuncMobile},moveFunc(e){e=e||window.event,e.preventDefault();let t=e.clientX-this.clientX,s=e.clientY-this.clientY;this.imgLeft+=t*2,this.imgTop+=s*2,this.clientX=e.clientX,this.clientY=e.clientY},moveFuncMobile(e){if(e=e||window.event,e.touches.length>1){var t=e.touches,s=this.getDistance(t[0],t[1])/this.getDistance(this.start[0],this.start[1]);this.mobileScale?s>1?this.scaleFunc(s+this.mobileScale-1,!0):this.scaleFunc(s*this.mobileScale,!0):this.scaleFunc(s,!0)}else{let o=e.touches[0];e.preventDefault();let i=o.pageX-this.clientX,n=o.pageY-this.clientY;this.imgLeft+=i*2,this.imgTop+=n*2,this.clientX=o.pageX,this.clientY=o.pageY}},removeMove(e){e==="pc"?this.$refs.heImg.onmousemove=null:(this.mobileScale=this.imgScale,this.$refs.heImg.ontouchmove=null)},keyHandleDebounce(e){this.canRun&&(this.keyHandle(e),this.canRun=!1,setTimeout(()=>{this.canRun=!0},100))},keyHandle(e){e=window.event||e;var t=e.keyCode||e.which||e.charCode;let s=this.shortcutList.find(o=>o.keyNum===t);s&&s.handle()},clickMask(){this.clickMaskCLose&&this.close({way:"mask"})},getDistance(e,t){var s=t.pageX-e.pageX,o=t.pageY-e.pageY;return Math.sqrt(s*s+o*o)},downloadIamge(){let e=new Image;e.setAttribute("crossOrigin","anonymous"),e.onload=function(){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height);let o=t.toDataURL("image/png"),i=document.createElement("a"),n=new MouseEvent("click");i.download="photo"+ +new Date,i.href=o,i.dispatchEvent(n)},e.onerror=function(t){console.log("图片信息不正确或图片服务器禁止访问"),console.log(t)},e.src=this.imgList[this.imgIndex]},isValidColor(e,t,s,o){if(o<128)return!1;const i=(e+t+s)/3;return!(i>240||i<15)},getDominantColorWithFilter(e){const t=document.createElement("canvas"),s=t.getContext("2d"),o=100,i=Math.min(o/e.naturalWidth,o/e.naturalHeight,1);t.width=e.width*i,t.height=e.height*i,s.drawImage(e,0,0);const l=s.getImageData(0,0,t.width,t.height).data,a={};let u=0,d="";for(let c=0;c<l.length;c+=4){const C=l[c],N=l[c+1],S=l[c+2],R=l[c+3];if(!this.isValidColor(C,N,S,R))continue;const w=`${C},${N},${S}`;a[w]=(a[w]||0)+1,a[w]>u&&(u=a[w],d=w)}const p=document.querySelector(".hevue-imgpreview-wrap.glass");return p.style.setProperty("--hevueimg-main-text-color",`rgb(${d}, .7)`),p.style.setProperty("--hevueimg-main-text-color",`rgb(${d}, .5)`),d},rgbToHsl(e,t,s){e/=255,t/=255,s/=255;const o=Math.max(e,t,s),i=Math.min(e,t,s);let n,l,a=(o+i)/2;if(o===i)n=l=0;else{const u=o-i;switch(l=a>.5?u/(2-o-i):u/(o+i),o){case e:n=(t-s)/u+(t<s?6:0);break;case t:n=(s-e)/u+2;break;case s:n=(e-t)/u+4;break}n/=6}return[n*360,l,a]},hslToRgb(e,t,s){e/=360;let o,i,n;if(t===0)o=i=n=s;else{const l=(d,p,c)=>(c<0&&(c+=1),c>1&&(c-=1),c<.16666666666666666?d+(p-d)*6*c:c<.5?p:c<.6666666666666666?d+(p-d)*(.6666666666666666-c)*6:d),a=s<.5?s*(1+t):s+t-s*t,u=2*s-a;o=l(u,a,e+1/3),i=l(u,a,e),n=l(u,a,e-1/3)}return[Math.round(o*255),Math.round(i*255),Math.round(n*255)]},adjustColor(e,t=.5){const[s,o]=this.rgbToHsl(...e);return this.hslToRgb(s,o,t)}}},V={class:"heimgfont hevue-img-status-icon rotate-animation"},W=["src"],O=["src"],U={class:"heimgfont hevue-img-status-icon"},j={class:"he-bottom-wrap"},z={class:"hevue-custom-rotate-wrap"},_={class:"hevue-custom-range-label theme-item"},q=["onClick","innerHTML","title"],J={class:"he-imglist-wrap"},Q=["onClick"],K=["src"],Z={key:1,class:"he-control-num theme-item"},$={class:"hevue-img-help-wrap theme-item"},ee={class:"hevue-img-help-item-label"},te={class:"hevue-img-help-item-desc"},ie={style:{display:"none"}};function se(e,t,s,o,i,n){return i.visible?(h(),m("div",{key:0,class:"hevue-imgpreview-wrap",id:"hevue-imgpreview-wrap",ref:"heImg",onMouseup:t[15]||(t[15]=l=>n.removeMove("pc")),onTouchend:t[16]||(t[16]=l=>n.removeMove("mobile"))},[r("div",{class:b(["hevue-img-mask",{heShow:i.showTranstion}]),onClick:t[0]||(t[0]=f((...l)=>n.clickMask&&n.clickMask(...l),["stop"]))},null,2),r("div",{class:b(["he-img-wrap",{heShow:i.showTranstion}])},[g(r("div",V,"  ",512),[[v,i.imgState===1]]),n.vueVersion>2?(h(),D(E,{key:0,name:"fade"},{default:M(()=>[(h(!0),m(k,null,x(i.needLoadImg,l=>g((h(),m("img",{src:l.url,onClick:t[1]||(t[1]=f(()=>{},["stop"])),key:l.index,ref_for:!0,ref:"heImg"+l.index,class:"he-img-view",style:L([i.imgIndex,i.fromIndex].includes(l.index)?n.getImgPostion:i.maxWH),onContextmenu:t[2]||(t[2]=(...a)=>n.imgContextMenu&&n.imgContextMenu(...a)),onMousedown:t[3]||(t[3]=(...a)=>n.addMove&&n.addMove(...a)),onTouchstart:t[4]||(t[4]=(...a)=>n.addMoveMobile&&n.addMoveMobile(...a))},null,44,W)),[[v,i.imgState===2&&i.imgIndex==l.index]])),128))]),_:1})):(h(!0),m(k,{key:1},x(i.needLoadImg,l=>g((h(),m("img",{src:l.url,onClick:t[5]||(t[5]=f(()=>{},["stop"])),key:l.index,ref_for:!0,ref:"heImg"+l.index,class:"he-img-view",style:L([i.imgIndex,i.fromIndex].includes(l.index)?n.getImgPostion:i.maxWH),onContextmenu:t[6]||(t[6]=(...a)=>n.imgContextMenu&&n.imgContextMenu(...a)),onMousedown:t[7]||(t[7]=(...a)=>n.addMove&&n.addMove(...a)),onTouchstart:t[8]||(t[8]=(...a)=>n.addMoveMobile&&n.addMoveMobile(...a))},null,44,O)),[[v,i.imgState===2&&i.imgIndex==l.index]])),128)),g(r("div",U,"  ",512),[[v,i.imgState===3]]),i.closeBtn?(h(),m("div",{key:2,class:"heimgfont he-close-icon theme-item",onClick:t[9]||(t[9]=f(l=>n.close({way:"closeBtn"}),["stop"]))},t[17]||(t[17]=[r("span",null,"",-1)]))):y("",!0),i.arrowBtn&&n.multiple?(h(),m("div",{key:3,class:"arrow arrow-left heimgfont theme-item",onClick:t[10]||(t[10]=f(l=>n.prevNextHandle(!1,"arrow-btn"),["stop"]))},t[18]||(t[18]=[r("span",null,"",-1)]))):y("",!0),i.arrowBtn&&n.multiple?(h(),m("div",{key:4,class:"arrow arrow-right heimgfont theme-item",onClick:t[11]||(t[11]=f(l=>n.prevNextHandle(!0,"arrow-btn"),["stop"]))},t[19]||(t[19]=[r("span",null,"",-1)]))):y("",!0),r("div",j,[F(H,{name:"fade"},{default:M(()=>[g(r("div",z,[r("span",_,[r("span",null,I(i.imgRotate)+"°",1)]),g(r("input",{class:"hevue-custom-range theme-item","onUpdate:modelValue":t[12]||(t[12]=l=>i.imgRotate=l),type:"range",id:"vol",min:"0",max:"360",orient:"vertical"},null,512),[[X,i.imgRotate,void 0,{number:!0}]])],512),[[v,i.showHevueImgRotate]])]),_:1}),i.controlBar.length?(h(),m("div",{key:0,onClick:t[13]||(t[13]=f(()=>{},["stop"])),class:"he-control-bar theme-item"},[(h(!0),m(k,null,x(n.controlbarShowItems,(l,a)=>g((h(),m("div",{class:"he-control-btn heimgfont",key:a,onClick:f(u=>l.handle(),["stop"]),innerHTML:l.icon,title:l.title},null,8,q)),[[v,l.show()]])),128))])):y("",!0),g(r("div",J,[r("div",{class:"he-imglist",style:L({left:n.getThumbLeft()+"px"})},[(h(!0),m(k,null,x(i.imgList,(l,a)=>(h(),m("div",{class:b(["he-img-item",{active:a==i.imgIndex}]),key:a,onClick:u=>n.toogleImg(a,"thumb")},[r("img",{src:l,class:"he-img-item-img",onContextmenu:t[14]||(t[14]=(...u)=>n.imgContextMenu&&n.imgContextMenu(...u))},null,40,K)],10,Q))),128))],4)],512),[[v,i.thumbnail&&n.multiple]]),i.controlBar.length&&n.multiple?(h(),m("div",Z,[r("span",null,I(i.imgIndex+1)+" / "+I(i.imgList.length),1)])):y("",!0)]),F(H,{name:"fade"},{default:M(()=>[g(r("div",$,[(h(!0),m(k,null,x(i.shortcutList,l=>(h(),m("div",{class:"hevue-img-help-item",key:l.keyName},[r("div",ee,I(l.keyName)+"：",1),r("div",te,I(l.desc),1)]))),128))],512),[[v,i.showHevueImgHelp]])]),_:1})],2),(h(),m("svg",ie,t[20]||(t[20]=[Y('<filter id="glass-distortion" x="0%" y="0%" width="100%" height="100%" filterUnits="objectBoundingBox" data-v-5efbdf0f><feTurbulence type="fractalNoise" baseFrequency="0.01 0.01" numOctaves="1" seed="5" result="turbulence" data-v-5efbdf0f></feTurbulence><feComponentTransfer in="turbulence" result="mapped" data-v-5efbdf0f><feFuncR type="gamma" amplitude="1" exponent="10" offset="0.5" data-v-5efbdf0f></feFuncR><feFuncG type="gamma" amplitude="0" exponent="1" offset="0" data-v-5efbdf0f></feFuncG><feFuncB type="gamma" amplitude="0" exponent="1" offset="0.5" data-v-5efbdf0f></feFuncB></feComponentTransfer><feGaussianBlur in="turbulence" stdDeviation="3" result="softMap" data-v-5efbdf0f></feGaussianBlur><feSpecularLighting in="softMap" surfaceScale="5" specularConstant="1" specularExponent="100" lighting-color="white" result="specLight" data-v-5efbdf0f><fePointLight x="-200" y="-200" z="300" data-v-5efbdf0f></fePointLight></feSpecularLighting><feComposite in="specLight" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litImage" data-v-5efbdf0f></feComposite><feDisplacementMap in="SourceGraphic" in2="softMap" scale="150" xChannelSelector="R" yChannelSelector="G" data-v-5efbdf0f></feDisplacementMap></filter>',1)])))],544)):y("",!0)}const ne=B(G,[["render",se],["__scopeId","data-v-5efbdf0f"]]);let T={};function oe(e){typeof e=="string"?e={imgList:[e]}:Array.isArray(e)&&(e={imgList:e}),Object.keys(T).forEach(n=>{e[n]===void 0&&(e[n]=T[n])});const t=document.getElementById("hevue-img-preview-container");t&&t.remove();const s=document.createElement("div");s.id="hevue-img-preview-container",s.style.zIndex=e.zIndex||"9999",document.body.appendChild(s);const i=P(ne).mount(s);return Object.keys(e).map(n=>{i[n]=e[n]}),i.show(),i}export{oe as p};
